---
title: 'JavaScript åŸºç¡€å…³æ³¨ç‚¹ç¬”è®°'
date: 2020-10-31T11:14:40+08:00
tags:
  - javascript
description: 'JavaScript è¸©å‘å¤§å…¨ã€‚'
image: '/images/2020/js-extends-note/header.webp'
---

JavaScript åŸºç¡€å…³æ³¨ç‚¹ç¬”è®°ï¼Œéšç€è‡ªå·±å¼€å‘ä¸­é‡åˆ°çš„å„ç§é—®é¢˜è€Œé€æ¸æ›´æ–°ã€‚

<!--more-->

## æ•°æ®ç±»å‹

ä¸ƒç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸€ç§å¤æ‚æ•°æ®ç±»å‹ï¼š

- `number`ï¼š+-(2^53-1) èŒƒå›´å†…çš„æ•°å­—
- `bigint`ï¼šä»»æ„é•¿åº¦çš„æ•´æ•°ã€‚
- `string`ï¼šå­—ç¬¦ä¸²
- `boolean`ï¼štrue å’Œ false
- `null`ï¼šæœªçŸ¥çš„å€¼
- `undefined`ï¼šæœªå®šä¹‰çš„å€¼
- `symbol`ï¼šå”¯ä¸€æ ‡è¯†ç¬¦
- `object`ï¼šå¤æ‚çš„æ•°æ®ç»“æ„

`typeof` è¿ç®—ç¬¦ï¼š

- `typeof null` ä¼šè¿”å› `"object"`ï¼Œä½†å®é™…ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚

### ç±»å‹è½¬æ¢

#### æ•°å­—ç±»å‹è½¬æ¢

```js
Number(''); // 0
Number('   123   '); // 123
Number('123z'); // NaN
Number(undefined); // NaN
Number(null); // 0
```

ä¸€å…ƒè¿ç®—ç¬¦ `+` æœ‰ç›¸åŒçš„æ•ˆæœã€‚æ³¨æ„ `null` å˜æˆæ•°å­— `0`ï¼Œ`undefined` å˜æˆ `NaN`ã€‚

#### å¸ƒå°”è½¬æ¢

```js
Boolean(0); // false
Boolean(''); // false
Boolean('0'); // true
```

#### è¿ç®—è½¬æ¢

```js
alert(2 + 2 + '1'); // 41ï¼Œ4 + '1' = 41
alert(6 - '2'); // 4ï¼Œå°† '2' è½¬æ¢ä¸ºæ•°å­—
alert('6' / '2'); // 3ï¼Œå°†ä¸¤ä¸ªè¿ç®—å…ƒéƒ½è½¬æ¢ä¸ºæ•°å­—
```

## å€¼æ¯”è¾ƒ

æ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨å­—å…¸é¡ºåºè¿›è¡Œåˆ¤å®šã€‚æŒ‰ç…§å­—ç¬¦ä¸²æ¯ä¸€ä½ä¾æ¬¡æ¯”è¾ƒï¼Œå‡ºç°ä¸åŒå³å¯å¾—å‡ºç»“æœï¼Œè‹¥ä¸€ç›´åˆ°æœ‰ä¸€æ–¹ç»“æŸä¾æ—§æœªå‡ºç»“æœï¼Œåˆ™è¾ƒé•¿çš„ä¸€æ–¹ä¸ºå¤§ã€‚

```js
alert(null > 0); // false
alert(null == 0); // false
alert(null >= 0); // true
alert(null === undefined); // false
```

ç›¸ç­‰æ€§æ£€æŸ¥ `==` å’Œæ™®é€šæ¯”è¾ƒç¬¦ `> < >= <=` çš„ä»£ç é€»è¾‘æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿›è¡Œå€¼çš„æ¯”è¾ƒæ—¶ï¼Œ`null` ä¼šè¢«è½¬åŒ–ä¸ºæ•°å­—ï¼Œå› æ­¤å®ƒè¢«è½¬åŒ–ä¸ºäº† `0`ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼ˆ3ï¼‰ä¸­ `null >= 0` è¿”å›å€¼æ˜¯ `true`ï¼Œï¼ˆ1ï¼‰ä¸­ `null > 0` è¿”å›å€¼æ˜¯ `false`ã€‚

å¦ä¸€æ–¹é¢ï¼Œ`undefined` å’Œ `null` åœ¨ç›¸ç­‰æ€§æ£€æŸ¥ `==` ä¸­ä¸ä¼šè¿›è¡Œä»»ä½•çš„ç±»å‹è½¬æ¢ï¼Œå®ƒä»¬æœ‰è‡ªå·±ç‹¬ç«‹çš„æ¯”è¾ƒè§„åˆ™ï¼Œæ‰€ä»¥é™¤äº†å®ƒä»¬ä¹‹é—´äº’ç­‰å¤–ï¼Œä¸ä¼šç­‰äºä»»ä½•å…¶ä»–çš„å€¼ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆï¼ˆ2ï¼‰ä¸­ `null == 0` ä¼šè¿”å› `false`ã€‚

## å­—ç¬¦ä¸²

è¿™äº›ç¬¦å·çš„é•¿åº¦æ˜¯ 2ï¼š

```js
alert('ğ’³'.length); // 2
alert('ğŸ˜‚'.length); // 2
alert('ğ©·¶'.length); // 2
```

`String.fromCodePoint` å’Œ `str.codePointAt` æ˜¯å‡ ç§å¤„ç†å®ƒä»¬å°‘æ•°æ–¹æ³•ã€‚åŸå…ˆçš„ `String.fromCharCode` å’Œ `str.charCodeAt` å¹¶ä¸èƒ½å¾ˆå¥½çš„å¤„ç†è¿™äº› UTF-16 å­—ç¬¦ã€‚å®ƒä»¬çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚

åŒæ—¶ç”¨äºå¾ªç¯å¯è¿­ä»£å¯¹è±¡çš„ `for of` ä¹Ÿèƒ½æ­£ç¡®å¤„ç†è¿™ç±»å­—ç¬¦ã€‚

## æ•°ç»„

åœ¨æ•°ç»„ä¸­æœç´¢ï¼š

```js
const arr = [NaN];
alert(arr.indexOf(NaN)); // -1ï¼ˆåº”è¯¥ä¸º 0ï¼Œä½†æ˜¯ä¸¥æ ¼ç›¸ç­‰ === equality å¯¹ NaN æ— æ•ˆï¼‰
alert(arr.includes(NaN)); // trueï¼ˆè¿™ä¸ªç»“æœæ˜¯å¯¹çš„ï¼‰
```

ç®€å•æ’åºï¼š

```js
arr.sort((a, b) => a - b);
```

## å¯¹è±¡

æ•´æ•°å±æ€§ä¼šè¢«è¿›è¡Œæ’åºï¼Œå…¶ä»–å±æ€§åˆ™æŒ‰ç…§åˆ›å»ºçš„é¡ºåºæ˜¾ç¤ºã€‚

ç®€å•å¯¹è±¡å…‹éš†ï¼š`Object.assign({}, obj);`

### å¯é€‰é“¾

å¯é€‰é“¾ `?.` æ˜¯ä¸€ç§è®¿é—®åµŒå¥—å¯¹è±¡å±æ€§çš„é˜²é”™è¯¯æ–¹æ³•ã€‚å³ä½¿ä¸­é—´çš„å±æ€§ä¸å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå‡ºç°é”™è¯¯ã€‚

```js
alert(user.address && user.address.street);
alert(user?.address?.street);
```

å¯é€‰é“¾ `?.` ä¸æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè€Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯­æ³•ç»“æ„ã€‚å®ƒè¿˜å¯ä»¥ä¸å‡½æ•°å’Œæ–¹æ‹¬å·ä¸€èµ·ä½¿ç”¨ã€‚

```js
user.exportData?.();
user?.['assas'];
```

### å¯¹è±¡ä¸æ•°ç»„å¤åˆ¶

```js
// æ•°ç»„
let arr = [1, 2, 3];
let arrCopy = [...arr];
let arrCopy = Object.assign([], arr);
// å¯¹è±¡
let obj = { a: 1, b: 2, c: 3 };
let objCopy = { ...obj };
let objCopy = Object.assign({}, obj);
```

ä»¥ä¸Šä»£ç ç­‰ä»·ï¼Œä½†éƒ½æ˜¯æµ…æ‹·è´ã€‚

### åŸå‹é“¾å±æ€§

`for..in` ä¸ `Object.hasOwnProperty()` çš„ä¸åŒä¹‹å¤„åœ¨äº `for..in` ä¼šå°†ä»åŸå‹é“¾ç»§æ‰¿çš„å†…å®¹ä¸€å¹¶å¾ªç¯ã€‚

## Symbol

```js
let id1 = Symbol('id');
let id2 = Symbol('id');
alert(id1 === id2); // false
alert(id1.toString()); // Symbol(id)
alert(id1.description); // id
// ä»å…¨å±€æ³¨å†Œè¡¨ä¸­è¯»å–
let id = Symbol.for('id'); // å¦‚æœè¯¥ Symbol ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ
let idAgain = Symbol.for('id');
alert(id === idAgain); // true
```

å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å±äºç¬¬ä¸‰æ–¹ä»£ç çš„æŸä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬æƒ³è¦ç»™å®ƒä»¬æ·»åŠ ä¸€äº›æ ‡è¯†ç¬¦ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ç»™å®ƒä»¬ä½¿ç”¨ Symbol é”®è€Œä¸ç”¨æ‹…å¿ƒè¦†ç›–åŸæœ‰å±æ€§çš„é—®é¢˜ã€‚`Object.keys()` å’Œ `for in` éƒ½ä¼šè·³è¿‡ Symbolã€‚

## Map å’Œ Set

åœ¨æ•°ç»„å’Œå¯¹è±¡ä¹‹å¤–è¿˜æœ‰ä¸¤ç§å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼ŒMap å’Œ Setã€‚

Map æ˜¯ä¸€ä¸ªå¸¦é”®çš„æ•°æ®é¡¹çš„é›†åˆï¼Œå’Œå¯¹è±¡å¾ˆç±»ä¼¼ï¼Œå®ƒä»¬çš„æœ€å¤§å·®åˆ«æ˜¯ Map å…è®¸ä½¿ç”¨ä»»ä½•ç±»å‹çš„æ•°æ®ä½œä¸ºé”®ï¼Œè€Œä¸åªæ˜¯å­—ç¬¦ä¸²å’Œ Symbolã€‚æ³¨æ„è™½ç„¶å¯è¡Œï¼Œä½† `map[key]` ä¸æ˜¯ä½¿ç”¨ Map çš„æ­£ç¡®æ–¹å¼ï¼Œè€Œåº”è¯¥ä½¿ç”¨ `set()`ã€`get()`ã€`has()` ç­‰æ–¹æ³•ï¼›Set æ˜¯å€¼çš„é›†åˆï¼Œå®ƒä¸å­˜åœ¨é”®å¹¶ä¸”æ¯ä¸€ä¸ªå€¼åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚

WeakMap æ˜¯ç±»ä¼¼äº Map çš„é›†åˆï¼Œå®ƒä»…å…è®¸å¯¹è±¡ä½œä¸ºé”®ï¼Œå¹¶ä¸”ä¸€æ—¦é€šè¿‡å…¶ä»–æ–¹å¼æ— æ³•è®¿é—®å®ƒä»¬ï¼Œä¾¿ä¼šå°†å®ƒä»¬ä¸å…¶å…³è”å€¼ä¸€åŒåˆ é™¤ï¼›WeakSet æ˜¯ç±»ä¼¼äº Set çš„é›†åˆï¼Œå®ƒä»…å­˜å‚¨å¯¹è±¡ï¼Œå¹¶ä¸”ä¸€æ—¦é€šè¿‡å…¶ä»–æ–¹å¼æ— æ³•è®¿é—®å®ƒä»¬ï¼Œä¾¿ä¼šå°†å…¶åˆ é™¤ã€‚å®ƒä»¬éƒ½ä»…å…è®¸å•ä¸ªæ“ä½œã€‚

å¯¹äº Mapï¼š

```js
let john = { name: 'John' };
let map = new Map();
map.set(john, '...');
john = null;
// john ä¾æ—§è¢«å­˜å‚¨åœ¨ map ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ map.keys() æ¥è·å–å®ƒ
```

è€Œå¯¹äº WeakMapï¼š

```js
let john = { name: 'John' };
let weakMap = new WeakMap();
weakMap.set(john, '...');
john = null;
// john è¢«ä»å†…å­˜ä¸­åˆ é™¤äº†ï¼
```

## å‡½æ•°

å‡½æ•°è¡¨è¾¾å¼æ˜¯åœ¨ä»£ç æ‰§è¡Œåˆ°è¾¾æ—¶è¢«åˆ›å»ºï¼Œå¹¶ä¸”ä»…ä»é‚£ä¸€åˆ»èµ·å¯ç”¨ï¼›å‡½æ•°å£°æ˜ç”±äºå£°æ˜æå‡ï¼Œå› æ­¤åœ¨ä»£ç æ®µä¸­è¢«å®šä¹‰ä¹‹å‰çš„ä½ç½®å®ƒå°±å¯ä»¥è¢«è°ƒç”¨ã€‚

å‡½æ•°å£°æ˜åªåœ¨å®ƒæ‰€åœ¨çš„ä»£ç å—ä¸­å¯è§ï¼Œå› æ­¤è‹¥éœ€è¦é€šè¿‡ `if` åˆ¤æ–­æ¡ä»¶èµ‹å€¼å‡½æ•°åˆ™éœ€è¦è¡¨è¾¾å¼ã€‚

### rest å‚æ•°ä¸ arguments

ä½¿ç”¨ `...rest` äºå‚æ•°åˆ—è¡¨æœ«å°¾è®¿é—®å‰©ä½™å‚æ•°æ•°ç»„ã€‚åœ¨æ—§ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º `arguments` çš„ç‰¹æ®Šçš„ç±»æ•°ç»„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æŒ‰å‚æ•°ç´¢å¼•åŒ…å«æ‰€æœ‰å‚æ•°ã€‚ç®­å¤´å‡½æ•°æ²¡æœ‰ `arguments`ã€‚

### è£…é¥°è€…æ¨¡å¼å’Œè½¬å‘

#### é€æ˜ç¼“å­˜

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª CPU é‡è´Ÿè½½çš„å‡½æ•° `slow(x)`ï¼Œä½†å®ƒçš„ç»“æœæ˜¯ç¨³å®šçš„ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºç›¸åŒçš„ `x`ï¼Œå®ƒæ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœç»å¸¸è°ƒç”¨è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†ç»“æœç¼“å­˜ä¸‹æ¥ï¼Œä»¥é¿å…åœ¨é‡æ–°è®¡ç®—ä¸ŠèŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚

```js
function slow(x) {
  // è¿™é‡Œå¯èƒ½ä¼šæœ‰é‡è´Ÿè½½çš„ CPU å¯†é›†å‹å·¥ä½œ
  alert(`Called with ${x}`);
  return x;
}
function cachingDecorator(func) {
  let cache = new Map();
  return function (x) {
    if (cache.has(x)) {
      return cache.get(x); // ä»ç¼“å­˜ä¸­è¯»å–ç»“æœ
    }
    let result = func(x); // å¦åˆ™å°±è°ƒç”¨ func
    cache.set(x, result); // ç„¶åå°†ç»“æœç¼“å­˜ï¼ˆè®°ä½ï¼‰ä¸‹æ¥
    return result;
  };
}
slow = cachingDecorator(slow);
alert(slow(1)); // slow(1) è¢«ç¼“å­˜ä¸‹æ¥äº†
alert('Again: ' + slow(1)); // ä¸€æ ·çš„
```

`cachingDecorator(func)` çš„ç»“æœå°±æ˜¯ä¸€ä¸ª "åŒ…è£…å™¨"ã€‚

#### è®¾å®šä¸Šä¸‹æ–‡

ä»¥ä¸Šçš„åŒ…è£…ä¸é€‚ç”¨äºå¯¹è±¡æ–¹æ³•ã€‚ä½¿ç”¨ï¼š

```js
let worker = {
  someMethod() {
    return 1;
  },
  slow(x) {
    alert('Called with ' + x); // å¯æ€•çš„ CPU è¿‡è½½ä»»åŠ¡
    return x * this.someMethod(); // (*)
  },
};
alert(worker.slow(1)); // åŸå§‹æ–¹æ³•æœ‰æ•ˆ
worker.slow = cachingDecorator(worker.slow); // ç°åœ¨å¯¹å…¶è¿›è¡Œç¼“å­˜
alert(worker.slow(2)); // Error: Cannot read property 'someMethod' of undefined
```

ä½¿ç”¨ `func.call` æ¥è§£å†³ï¼š

```js
function cachingDecorator(func) {
  let cache = new Map();
  return function (x) {
    if (cache.has(x)) {
      return cache.get(x);
    }
    let result = func.call(this, x); // ç°åœ¨ "this" è¢«æ­£ç¡®åœ°ä¼ é€’äº†
    cache.set(x, result);
    return result;
  };
}
worker.slow = cachingDecorator(worker.slow); // ç°åœ¨å¯¹å…¶è¿›è¡Œç¼“å­˜
alert(worker.slow(2)); // å·¥ä½œæ­£å¸¸
alert(worker.slow(2)); // å·¥ä½œæ­£å¸¸ï¼Œæ²¡æœ‰è°ƒç”¨åŸå§‹å‡½æ•°ï¼ˆä½¿ç”¨çš„ç¼“å­˜ï¼‰
```

1. åœ¨ç»è¿‡è£…é¥°ä¹‹åï¼Œ`worker.slow` ç°åœ¨æ˜¯åŒ…è£…å™¨ `function (x) { ... }`
2. å› æ­¤ï¼Œå½“ `worker.slow(2)` æ‰§è¡Œæ—¶ï¼ŒåŒ…è£…å™¨å°† `2` ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸” `this=worker` (å®ƒæ˜¯ç‚¹ç¬¦å· `.` ä¹‹å‰çš„å¯¹è±¡)
3. åœ¨åŒ…è£…å™¨å†…éƒ¨ï¼Œå‡è®¾ç»“æœå°šæœªç¼“å­˜ï¼Œ`func.call(this, x)` å°†å½“å‰çš„ `this` (worker) å’Œå½“å‰çš„å‚æ•°ä¼ é€’ç»™åŸå§‹æ–¹æ³•

### this ä¸¢å¤±

ç»å…¸çš„ this ä¸¢å¤±é—®é¢˜ï¼š

```js
let user = {
  name: 'John',
  sayHi() {
    alert(`Hello, ${this.name}!`);
  },
};
setTimeout(user.sayHi, 1000); // Hello, !
// ç­‰ä»·äº
let f = user.sayHi;
setTimeout(f, 1000); // éä¸¥æ ¼æ¨¡å¼ä¸‹ this = window
```

`setTimeout` è·å–åˆ°äº†å‡½æ•° `user.sayHi`ï¼Œä½†å®ƒå’Œå¯¹è±¡åˆ†ç¦»å¼€äº†ã€‚

æœ€ç®€è§£å†³æ–¹æ³• (åŒ…è£…)ï¼š

```js
setTimeout(() => user.sayHi(), 1000); // Hello, John!
```

ç»‘å®š `this` (React ä¸­ class ç»„ä»¶å°±éœ€è¦è¿™ç§æ–¹æ³•)ï¼š

```js
let f = user.sayHi.bind(user);
setTimeout(f, 1000); // Hello, John!
```

### ç®­å¤´å‡½æ•°

- æ²¡æœ‰ `this`
- æ²¡æœ‰ `arguments`
- ä¸èƒ½ä½¿ç”¨ `new` è¿›è¡Œè°ƒç”¨
- å®ƒæ²¡æœ‰ `super`

```js
let group = {
  title: 'Our Group',
  students: ['John', 'Pete', 'Alice'],
  showListCorrect() {
    this.students.forEach((student) => alert(this.title + ': ' + student));
  },
  showListWrong() {
    this.students.forEach(function (student) {
      alert(this.title + ': ' + student); // Error: Cannot read property 'title' of undefined
    });
  },
};
```

## ç±»ä¸ç»§æ‰¿

### ç»‘å®šæ–¹æ³•

å¯ä»¥ä½¿ç”¨ç±»å­—æ®µæ¥ç»‘å®šç±»æ–¹æ³•ï¼š

```js
class Button {
  constructor(value) {
    this.value = value;
  }
  click = () => {
    alert(this.value);
  };
}
const button = new Button('hello');
setTimeout(button.click, 1000); // hello
```

### å­—æ®µåˆå§‹åŒ–

ç±»å­—æ®µæ˜¯è¿™æ ·åˆå§‹åŒ–çš„ï¼š

- å¯¹äºåŸºç±» (è¿˜æœªç»§æ‰¿ä»»ä½•ä¸œè¥¿çš„é‚£ç§)ï¼Œåœ¨æ„é€ å‡½æ•°è°ƒç”¨å‰åˆå§‹åŒ–
- å¯¹äºæ´¾ç”Ÿç±»ï¼Œåœ¨ `super()` **å**ç«‹åˆ»åˆå§‹åŒ–

å› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ä¸¤æ¬¡çš„è¾“å‡ºéƒ½æ˜¯ `animal`ï¼š

```js
class Animal {
  name = 'animal';
  constructor() {
    alert(this.name); // (*)
  }
}
class Rabbit extends Animal {
  name = 'rabbit';
  // constructor(...args) {
  //   super(...args); // æ­¤æ—¶ `Rabbit` è¿˜æ²¡æœ‰è‡ªå·±çš„ `name` å­—æ®µ
  // }
}
new Animal(); // animal
new Rabbit(); // animal
```
